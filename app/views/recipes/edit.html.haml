.breadcrumb
  = link_to 'Recipes', root_url
  %span.separator /
  = link_to @recipe.display_name, @recipe
  %span.separator /
  %span.active Edit

.page-header
  %div
    %h1 Edit Recipe
    .recipe-stats
      - if @recipe.parent
        Variant of #{@recipe.parent.name}
      - else
        %span
          = pluralize(@recipe.cooks.count, 'cook')
          - if @recipe.variants.any?
            â€¢
            = pluralize(@recipe.variants.count, 'variant')

  - if @recipe.persisted?
    = button_to 'Delete', @recipe, method: :delete, class: 'btn btn-danger', data: { turbo_confirm: 'Are you sure? This cannot be undone.' }

#recipe_form_container
  - if @recipe.errors.any?
    #error_explanation
      %h2
        = pluralize(@recipe.errors.count, "error")
        prevented this recipe from being saved:
      %ul
        - @recipe.errors.full_messages.each do |message|
          %li= message

  = form_with model: @recipe, class: 'recipe-form' do |f|
    .card.mb-lg
      .card-header
        Basic Info
      .card-body
        .form-group
          = f.label :name, class: 'form-label'
          = f.text_field :name, class: 'form-control', placeholder: 'Recipe name'

        .form-row
          .form-group
            = f.label :section_id, 'Section', class: 'form-label'
            = f.collection_select :section_id, Current.cookbook.sections.by_position, :id, :name, {include_blank: 'Uncategorized'}, {class: 'form-control'}

          .form-group
            = f.label :parent_id, 'Variant of', class: 'form-label'
            - disabled = f.object.persisted? && f.object.variants.any?
            = f.collection_select :parent_id, Current.cookbook.recipes.bases_only.where(section: f.object.section).abc, :id, :name, {include_blank: 'None (base recipe)'}, {class: 'form-control', disabled: disabled}
            - if disabled
              .form-help Cannot change - recipe has variants

        .form-group
          = f.label :link, 'External Link', class: 'form-label'
          = f.text_field :link, class: 'form-control', placeholder: 'https://example.com/recipe'

    .card.mb-lg
      .card-header
        Instructions
      .card-body
        = f.rich_text_area :instructions, style: 'min-height: 15em'

    .form-actions
      = f.submit 'Save Changes', class: 'btn btn-primary'
      = link_to 'Cancel', @recipe, class: 'btn btn-secondary'
