= content_for :title, @recipe.display_name

.breadcrumb
  = link_to 'Recipes', root_url
  %span.separator /
  - if @recipe.section
    - sections = Current.cookbook.sections.by_position.to_a
    - section_index = sections.index(@recipe.section)
    - section_anchor = section_index == 0 ? root_url : root_url + "#section-#{@recipe.section.id}"
    = link_to @recipe.section.name, section_anchor
    %span.separator /
  %span.active= @recipe.display_name

.recipe-header
  %div
    %h1.recipe-title{ class: [('favorite' if @recipe.favorite? && !@recipe.forgotten?), ('forgotten' if @recipe.forgotten?)].compact }
      = @recipe.display_name

    .recipe-badges
      - if @recipe.section
        - color_class = section_color_class(@recipe.section)
        %span.badge{ class: color_class ? ['section-badge', color_class] : 'badge-secondary' }= @recipe.section.name
      - if @recipe.parent
        %span.badge.badge-info
          Variant of
          = link_to @recipe.parent.name, @recipe.parent
      - if @recipe.variants.any?
        %span.badge.badge-info
          = pluralize(@recipe.variants.count, 'variant')

    .recipe-stats
      Prepared #{pluralize(@recipe.cooks.count, 'time')}
      - if @recipe.family_last_cooked_on
        • Last: #{local_time(@recipe.family_last_cooked_on, '%B %e, %Y')}

  .recipe-actions
    = link_to 'Edit', [:edit, @recipe], class: 'btn btn-primary'
    - if @recipe.link
      = link_to 'Open Link', @recipe.link, class: 'btn btn-secondary', target: '_blank', rel: 'noopener'

- if @recipe.variants.any?
  .card.mb-lg
    .card-header
      Variants
    .card-body
      - @recipe.variants.abc.each do |variant|
        %div
          = link_to variant.display_name, variant

.recipe-instructions
  = @recipe.instructions

.card.cook-log-card
  .card-header
    Cooking Log
  .card-body
    .cook-log-form-section
      = form_with model: Cook.new(date: Date.today), url: [@recipe, :cooks], class: 'cook-form' do |f|
        .form-group
          = f.label :date, class: 'form-label'
          = f.date_field :date, value: Date.today, class: 'form-control'
        = f.submit 'Log Cook', class: 'btn btn-primary'

    - if @recipe.cooks.any?
      .cook-history-section
        .cook-history-header History
        .cook-history
          - @recipe.cooks.order(date: :desc).first(20).each do |c|
            .cook-entry
              .cook-date
                = local_time(c.date, '%B %e, %Y')
                = button_to '×', c, method: :delete, class: 'cook-delete', data: { turbo_confirm: 'Remove this cook?' }

